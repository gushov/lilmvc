/*! lilmvc - v0.0.7 - 2013-02-12
 * Copyright (c) 2013 August Hovland <gushov@gmail.com>; Licensed MIT */
(function(e){"use strict";function r(e,t){if(t.indexOf(".")===-1)return t;t=t.split("/"),e=e?e.split("/"):[],e.pop(),t[0]==="."&&t.shift();while(t[0]==="..")t.shift(),e.pop();return e.concat(t).join("/")}var t={},n={};e.provide=function(e,r,i){return i?t[e]=r:n[e]=r},e.require=function(i,s){var o,u,a=s||i;return n[a]?n[a]:(o=n[a]={},u={exports:o},t[a](function(t){return e.require(t,r(a,t))},u,o),n[a]=u.exports)}})(this),provide("lil_",function(e,t,n){t.exports={typeOf:function(e){var t=typeof e;return t==="object"&&(t=Array.isArray(e)?"array":t,t=e===null?"null":t),t},each:function(e,t,n){var r=this.typeOf(e),i;r==="array"&&e.length?e.forEach(t,n):r==="object"&&(i=e?Object.keys(e):[],i.forEach(function(r,i){t.call(n,r,e[r],i)}))},every:function(e,t,n){var r=this.typeOf(e),i;return r==="array"&&e.length?e.every(t,n):r==="object"?(i=e?Object.keys(e):[],i.every(function(r,i){return t.call(n,r,e[r],i)})):!1},some:function(e,t,n){var r=this.typeOf(e),i;return r==="array"&&e.length?e.some(t,n):r==="object"?(i=e?Object.keys(e):[],i.some(function(r,i){return t.call(n,r,e[r],i)})):!1},map:function(e,t,n){var r=this.typeOf(e),i=[];return r==="array"&&e.length?e.map(t,n):(r==="object"&&(i={},this.each(e,function(e,n,r){i[e]=t.call(this,e,n,r)},n)),i)},withOut:function(e,t){var n=[];return this.each(e,function(e){e!==t&&n.push(e)}),n},walk:function(e,t,n,r){var i=this,s=function(e,t){i.each(t,function(t,n){o(e[t],n,t,e)})},o=function(e,t,o,u){var a=i.typeOf(t);a==="object"?(!e&&u&&r&&(e=u[o]={}),s(e,t)):n.call(u,e,t,o)};o(e,t)},extend:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return this.each(e,function(e){this.each(e,function(e,n){t[e]=n})},this),t},defaults:function(e,t){return this.each(t,function(t,n){var r=this.typeOf(e[t]);if(r==="undefined"||r==="null")e[t]=n},this),e},match:function(e,t){var n=!0;return this.walk(e,t,function(e,t){n=e===t}),n},pick:function(e,t){var n={};return t=this.typeOf(t)==="array"?t:Object.keys(t),this.each(t,function(t){n[t]=e&&e[t]}),n}}},!0),provide("lilobj/arr",function(e,t,n){function i(){var e=[];return e.push.apply(e,arguments),e.__proto__=i.prototype,e}var r=e("lil_");i.prototype=[],i.prototype.isA=function(e){function t(){}return t.prototype=e,this instanceof t},i.prototype.extend=function(e){i.prototype=this;var t=new i;return r.each(e,function(n){t[n]=e[n]}),t},i.prototype.create=function(){i.prototype=this;var e=new i;return e.construct!==undefined&&e.construct.apply(e,arguments),e},t.exports=new i},!0),provide("lilobj/obj",function(e,t,n){var r=e("lil_");t.exports={isA:function(e){function t(){}return t.prototype=e,this instanceof t},extend:function(e){var t=Object.create(this);return r.each(e,function(e,n){t[e]=n}),t},create:function(){var e=Object.create(this);return e.construct!==undefined&&e.construct.apply(e,arguments),e}}},!0),provide("lilobj",function(e,t,n){var r=e("./lilobj/obj"),i=e("./lilobj/arr");t.exports={obj:r,arr:i}},!0),provide("vladiator",function(e,t,n){var r=e("lil_"),i={required:function(e){return typeof e!="undefined"&&e!==null},array:function(e){return Array.isArray(e)},number:function(e){return typeof e=="number"},string:function(e){return typeof e=="string"},"boolean":function(e){return typeof e=="boolean"},object:function(e){return typeof e=="object"},length:function(e,t,n){var r=!t||e.length>=t,i=!n||e.length<=n;return r&&i},gte:function(e,t){return e>=t}},s=function(e,t){var n={isValid:!0};return(e[0]==="required"||i.required(t))&&r.every(e,function(e){var r,s=[];return typeof e!="string"?(r=e[0],s=e.slice(1)):r=e,s.unshift(t),i[r].apply(null,s)?!0:(n.isValid=!1,n.error=r,!1)}),n.$=t,n};t.exports=s},!0),provide("lilmodel/collection",function(e,t,n){function o(e,t,n){return function(r,i){var s=!r&&t.create(i);n.call(e,r,s)}}var r=e("lilobj").arr,i=e("lil_"),s=e("./syncr");t.exports=r.extend({construct:function(e){i.each(e,function(e){this.push(this.model.create(e))},this),this.validate()},validate:function(){var e={isValid:!0,error:[]};return i.each(this,function(t){var n=t.validate();e.error.push(n.error),e.isValid=e.isValid&&n.isValid}),e},add:function(e){var t;e.isA&&e.isA(this.model)?t=e:t=this.model.create(e),this.push(t)},remove:function(e){var t;i.each(this,function(n,r){i.match(n,e)&&(t=r)}),typeof t=="number"&&this.splice(t,1)},get:function(e){return this.filter(function(t){return i.match(t,e)})},find:function(e,t,n){var r=s();this.query=e,r("find",this,o(n,this,t))},serialize:function(){return i.map(this,function(e){return e.serialize()})}})},!0),provide("lilmodel/model",function(e,t,n){function u(e){return this.$[e]}function a(e,t){var n=this.children&&this.children[e];n&&n.create&&typeof t=="object"?this.$[e]=n.create(t):n&&typeof t=="object"?this.$[e]=this.create(t):n||(this.$[e]=t)}function f(e,t,n){return function(r,i){var s=r?null:t.create(i);n.call(e,r,s)}}var r=e("lilobj").obj,i=e("lil_"),s=e("vladiator"),o=e("./syncr");t.exports=r.extend({construct:function(e){this.$={};var t=i.map(this.rules,function(e,t){return{enumerable:!0,get:u.bind(this,e),set:a.bind(this,e)}},this);Object.defineProperties(this,t),e=i.pick(e,this.rules),i.defaults(e,this.defaults),i.each(e,function(e,t){this[e]=t},this),this.validate()},validate:function(){var e={isValid:!0,error:{}};return i.each(this.rules,function(t,n){var r=this[t],i;r&&r.validate?i=r.validate():(i=s(n,r),r=i.$),e.error[t]=i.error,e.isValid=e.isValid&&i.isValid},this),e},save:function(e,t){var n=o(),r=this.$._id?"update":"create",i=this.validate();i.isValid?n(r,this,f(t,this,e)):e.call(t,i.error,this)},fetch:function(e,t){var n=o();n("fetch",this,f(t,this,e))},destroy:function(e,t){var n=o();n("destroy",this,f(t,this,e))},serialize:function(){return i.map(this.$,function(e,t){return this.children&&this.children[e]?t.serialize():t},this)}})},!0),provide("lilmodel/syncr",function(e,t,n){var r=function(e,t,n){n(null,t)};t.exports=function(e){return e&&(r=e),r}},!0),provide("lilmodel",function(e,t,n){var r=e("./lilmodel/syncr"),i=e("./lilmodel/model"),s=e("./lilmodel/collection");t.exports={syncr:r,model:i,collection:s}},!0),provide("lilrouter/win",function(e,t,n){var r=typeof window=="object"&&window;t.exports=function(e){return e&&(r=e),{go:function(e,t){r.history.pushState(e,"",t)},location:function(e){return e&&(r.location=e),r.location.pathname},onpopstate:function(e,t){setTimeout(function(){r.onpopstate=e.bind(t)},0)}}}},!0),provide("lilrouter/matcher",function(e,t,n){var r=e("lil_");t.exports=function(e,t){var n,i;return t==="/"?{handler:e["/"],params:{}}:(r.some(e,function(e,s){var o=r.withOut(t.split("/"),""),u=r.withOut(e.split("/"),"");return n={},i=s,e.charAt(0)!=="/"?(o.reverse(),u.reverse(),o=o.slice(0,u.length)):o.length=u.length,r.every(u,function(e,t){var r=e.indexOf(":")===0,i=e.charAt(e.length-1)==="?",s;return r&&(i||o[t])?(s=i?e.substr(1,e.length-2):e.substr(1),n[s]=o[t],!0):e===o[t]?!0:!1})}),{handler:i,params:n})}},!0),provide("lilrouter/router",function(e,t,n){var r=e("lil_"),i=e("lilobj").obj,s=e("./matcher"),o=e("./win");t.exports=i.extend({win:undefined,start:undefined,routes:{get:{},post:{}},construct:function(e){this.win=o(),this.start=this.win.location(),r.each(this.routes,function(t){r.each(e[t],function(e,n){this.routes[t][e]=n},this)},this),this.ctx=e.init(this),this.win.onpopstate(function(e){e.state?this.route(e.state.method,this.win.location(),e.state.body):this.route("get",this.start)},this),this.route("get",this.start,null,!0)},route:function(e,t,n,i){var o=s(this.routes[e],t),u=r.extend({},this.ctx,{params:o.params,body:n||{},pageload:!!i});o.handler(u,this)},get:function(e){this.win.go({method:"get"},e),this.route("get",e)},post:function(e,t){this.win.go({method:"post",body:t},e),this.route("post",e,t)}})},!0),provide("lilrouter",function(e,t,n){var r=e("./lilrouter/router");t.exports=r},!0),provide("lilmvc/view",function(e,t,n){var r=e("lilobj").obj,i=e("./template"),s=e("./dom");t.exports=r.extend({construct:function(e,t){this.$=s(),this.el=this.$(t),this.init(e)},template:function(e,t){var n=i();return n(e,t)},init:function(e){}})},!0),provide("lilmvc/controller",function(e,t,n){var r=e("lilobj").obj,i=e("lil_"),s=e("./bus");t.exports=r.extend({events:[],views:{},construct:function(e,t){this.bus=s.create(this.events),this.router=t,i.each(e,function(e,t){this.views[e]=t.create(this.bus,e)},this),this.init(this.bus)},init:function(e){}})},!0),provide("lilmvc/bus",function(e,t,n){var r=e("lilobj").obj,i=e("lil_");t.exports=r.extend({construct:function(e){this.listeners={};var t=this.ev={};i.each(e,function(e){t[e]=e})},on:function(e,t){this.listeners[e]?this.listeners[e].push(t):this.listeners[e]=[t]},emit:function(e,t){i.each(this.listeners[e],function(e){e(t)})}})},!0),provide("lilmvc/template",function(e,t,n){var r=function(e,t){return t};t.exports=function(e){return e&&(r=e),r}},!0),provide("lilmvc/dom",function(e,t,n){var r=function(e){return this};t.exports=function(e){return e&&(r=e),r}},!0),provide("lilmvc",function(e,t,n){var r=e("./lilmvc/dom"),i=e("./lilmvc/template"),s=e("./lilmvc/bus"),o=e("./lilmvc/controller"),u=e("./lilmvc/view"),a=e("lilmodel"),f=e("lilrouter");t.exports={template:i,dom:r,bus:s,controller:o,view:u,syncr:a.syncr,model:a.model,collection:a.collection,router:f}},!0);